# Deep Research Workflow
# Multi-agent research workflow that performs comprehensive topic analysis
# Inspired by Microsoft Agent Framework's DeepResearch pattern

name: deep_research_workflow
version: "1.0"
description: "Comprehensive multi-agent research workflow with planning, investigation, synthesis, and validation"

# Orchestration Pattern: Hybrid (Sequential → Concurrent → Sequential)
# - Phase 1: Sequential planning
# - Phase 2: Concurrent parallel research across 5 aspects
# - Phase 3-6: Sequential synthesis, validation, finalization, summarization

variables:
  - name: research_topic
    type: string
    required: true
    description: "The main topic or question to research"
  
  - name: research_depth
    type: string
    default: "comprehensive"
    description: "Research depth level: quick, standard, comprehensive, exhaustive"
  
  - name: max_sources
    type: number
    default: 10
    description: "Maximum number of sources to analyze"
  
  - name: include_citations
    type: boolean
    default: true
    description: "Whether to include citations in the final report"
  
  - name: research_plan
    type: object
    description: "Generated research plan with subtopics and approach"
  
  - name: research_findings
    type: object
    description: "Compiled research findings from all investigations"
  
  - name: final_report
    type: string
    description: "Final synthesized research report"
  
  - name: validation_results
    type: object
    description: "Quality validation results"

timeout: 3600  # 1 hour for comprehensive research
max_parallel_tasks: 5

tasks:
  # Phase 1: Research Planning
  - id: create_research_plan
    name: "Create Research Plan"
    type: agent
    agent: "planner"
    description: "Analyze the research topic and create a structured research plan"
    parameters:
      task: "Create a comprehensive research plan for the topic: ${research_topic}. Break down into key subtopics, identify research questions, and suggest investigation approaches."
      context:
        depth: "${research_depth}"
        max_sources: "${max_sources}"
    outputs:
      result: research_plan
    timeout: 300
    retry:
      max_attempts: 2
      delay_seconds: 3

  # Phase 2: Parallel Research Investigation (Concurrent Pattern)
  - id: investigate_core_concepts
    name: "Investigate Core Concepts"
    type: agent
    agent: "researcher"
    description: "Research the fundamental concepts and definitions"
    depends_on:
      - create_research_plan
    parameters:
      task: "Research the core concepts and fundamental definitions related to: ${research_topic}. Focus on authoritative sources and foundational understanding."
      context:
        research_plan: "${research_plan}"
        aspect: "core_concepts"
    outputs:
      result: core_concepts
    timeout: 600
    retry:
      max_attempts: 2
      delay_seconds: 5

  - id: investigate_current_state
    name: "Investigate Current State"
    type: agent
    agent: "researcher"
    description: "Research the current state and recent developments"
    depends_on:
      - create_research_plan
    parameters:
      task: "Investigate the current state, recent developments, and latest trends regarding: ${research_topic}. Focus on recent publications and authoritative sources from the last 2-3 years."
      context:
        research_plan: "${research_plan}"
        aspect: "current_state"
    outputs:
      result: current_state
    timeout: 600
    retry:
      max_attempts: 2
      delay_seconds: 5

  - id: investigate_applications
    name: "Investigate Practical Applications"
    type: agent
    agent: "researcher"
    description: "Research real-world applications and use cases"
    depends_on:
      - create_research_plan
    parameters:
      task: "Research practical applications, use cases, and real-world implementations of: ${research_topic}. Include examples, case studies, and success stories."
      context:
        research_plan: "${research_plan}"
        aspect: "applications"
    outputs:
      result: applications
    timeout: 600
    retry:
      max_attempts: 2
      delay_seconds: 5

  - id: investigate_challenges
    name: "Investigate Challenges and Limitations"
    type: agent
    agent: "researcher"
    description: "Research challenges, limitations, and criticisms"
    depends_on:
      - create_research_plan
    parameters:
      task: "Investigate the challenges, limitations, criticisms, and potential risks associated with: ${research_topic}. Include counterarguments and areas of concern."
      context:
        research_plan: "${research_plan}"
        aspect: "challenges"
    outputs:
      result: challenges
    timeout: 600
    retry:
      max_attempts: 2
      delay_seconds: 5

  - id: investigate_future_trends
    name: "Investigate Future Trends"
    type: agent
    agent: "researcher"
    description: "Research future directions and emerging trends"
    depends_on:
      - create_research_plan
    parameters:
      task: "Research future trends, predictions, and emerging directions for: ${research_topic}. Focus on expert opinions, forecasts, and potential developments."
      context:
        research_plan: "${research_plan}"
        aspect: "future_trends"
    outputs:
      result: future_trends
    timeout: 600
    retry:
      max_attempts: 2
      delay_seconds: 5

  # Phase 3: Synthesis (Sequential Pattern)
  - id: synthesize_findings
    name: "Synthesize Research Findings"
    type: agent
    agent: "writer"
    description: "Synthesize all research findings into a comprehensive report"
    depends_on:
      - investigate_core_concepts
      - investigate_current_state
      - investigate_applications
      - investigate_challenges
      - investigate_future_trends
    parameters:
      task: "Synthesize the following research findings into a comprehensive, well-structured report on: ${research_topic}"
      context:
        research_plan: "${research_plan}"
        core_concepts: "${core_concepts}"
        current_state: "${current_state}"
        applications: "${applications}"
        challenges: "${challenges}"
        future_trends: "${future_trends}"
        include_citations: "${include_citations}"
    outputs:
      result: draft_report
    timeout: 900
    retry:
      max_attempts: 2
      delay_seconds: 5

  # Phase 4: Quality Validation (Sequential Pattern)
  - id: validate_report
    name: "Validate Research Quality"
    type: agent
    agent: "reviewer"
    description: "Review and validate the research report for quality, accuracy, and completeness"
    depends_on:
      - synthesize_findings
    parameters:
      task: "Review the following research report for quality, accuracy, completeness, and coherence. Provide specific feedback and validation."
      content: "${draft_report}"
      context:
        original_topic: "${research_topic}"
        research_plan: "${research_plan}"
    outputs:
      result: validation_results
      success: is_valid
    timeout: 300
    retry:
      max_attempts: 1
      delay_seconds: 3

  # Phase 5: Final Report Generation (Sequential Pattern)
  - id: finalize_report
    name: "Finalize Research Report"
    type: agent
    agent: "writer"
    description: "Create the final polished research report incorporating validation feedback"
    depends_on:
      - validate_report
    parameters:
      task: "Create the final, polished version of the research report incorporating the validation feedback"
      content: "${draft_report}"
      context:
        validation_feedback: "${validation_results}"
        include_citations: "${include_citations}"
        research_topic: "${research_topic}"
    outputs:
      result: final_report
    timeout: 300
    retry:
      max_attempts: 2
      delay_seconds: 5

  # Phase 6: Generate Executive Summary (Sequential Pattern)
  - id: create_summary
    name: "Create Executive Summary"
    type: agent
    agent: "summarizer"
    description: "Generate a concise executive summary of the research"
    depends_on:
      - finalize_report
    parameters:
      task: "Create a concise executive summary of the research report, highlighting key findings, insights, and conclusions"
      content: "${final_report}"
      max_length: 500
    outputs:
      result: executive_summary
    timeout: 180
    retry:
      max_attempts: 2
      delay_seconds: 3

# Workflow completion outputs
outputs:
  final_report: "${final_report}"
  executive_summary: "${executive_summary}"
  research_plan: "${research_plan}"
  validation_results: "${validation_results}"
